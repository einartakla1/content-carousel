<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carousel Advertorial Editor</title>
    <link rel="stylesheet" href="./src/editor.css?v=1.2.0">
    <!-- Import Map for ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "jszip": "https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm",
            "file-saver": "https://cdn.jsdelivr.net/npm/file-saver@2.0.5/+esm",
            "sortablejs": "https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/+esm"
        }
    }
    </script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <div class="editor-container">
        <!-- Left Panel: Project Management & Settings & Slides -->
        <div class="left-panel">
            <div class="panel-header">
                <h1>Carousel Editor</h1>
                <div id="autoSaveStatus" style="font-size: 12px; color: rgba(255,255,255,0.8); margin-top: 4px;">
                    Auto-save: every 30 sec</div>
            </div>

            <!-- Draft/Published Switcher -->
            <div class="section" style="padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 12px;">
                <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                    <button class="btn-secondary active" id="viewDraft" style="flex: 1;">
                        <i data-lucide="edit" style="width: 14px; height: 14px;"></i>
                        Draft
                    </button>
                    <button class="btn-secondary" id="viewPublished" style="flex: 1;">
                        <i data-lucide="globe" style="width: 14px; height: 14px;"></i>
                        Published
                    </button>
                </div>
                <button class="btn-success" id="publishBtn" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i data-lucide="upload-cloud" style="width: 16px; height: 16px;"></i>
                    Publish Changes
                </button>
                <div id="publishStatus" style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 8px; text-align: center;"></div>
            </div>

            <!-- Carousel Management -->
            <div class="section">
                <button class="btn-primary" id="newProjectBtn"
                    style="width: 100%; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    <i data-lucide="plus-circle" style="width: 16px; height: 16px;"></i>
                    New Carousel
                </button>
                <button class="btn-secondary" id="loadProjectBtn"
                    style="width: 100%; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    <i data-lucide="folder-open" style="width: 16px; height: 16px;"></i>
                    Load Saved Carousel
                </button>
                <button class="btn-secondary" id="manualSaveBtn"
                    style="width: 100%; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    <i data-lucide="save" style="width: 16px; height: 16px;"></i>
                    Save Draft
                    <span style="margin-left: auto; font-size: 11px; opacity: 0.7;">⌘S</span>
                </button>
                <button class="btn-secondary" id="shareBtn" style="width: 100%; display: flex; align-items: center; gap: 8px;">
                    <i data-lucide="share-2" style="width: 16px; height: 16px;"></i>
                    Share Preview Link
                </button>
            </div>

            <!-- Carousel Settings (Collapsible, Open by default) -->
            <div class="collapsible-section active">
                <div class="collapsible-header">
                    <span>Carousel Settings</span>
                    <i data-lucide="chevron-right" class="collapsible-icon"></i>
                </div>
                <div class="collapsible-content">
                    <div class="section-inner">
                        <div class="form-group">
                            <label>Carousel ID</label>
                            <input type="text" id="carouselId" readonly>
                        </div>
                        <div class="form-group">
                            <label>Carousel Name (Internal)</label>
                            <input type="text" id="carouselName" placeholder="e.g., Fall Campaign 2025">
                            <p class="help-text">Internal name to distinguish between multiple carousels for the same customer</p>
                        </div>
                        <div class="form-group">
                            <label>Disclaimer Text</label>
                            <input type="text" id="disclaimerText" value="ANNONSØRINNHOLD">
                        </div>
                        <div class="form-group">
                            <label>Customer Name</label>
                            <input type="text" id="customerName" placeholder="e.g., URMAKER BJERKE">
                        </div>
                        <div class="form-group">
                            <label>Carousel Height (px)</label>
                            <input type="number" id="carouselHeight" value="516" min="300" max="800" step="1">
                            <p class="help-text">Total height of the carousel including header</p>
                        </div>
                        <div class="form-group">
                            <label>Slide Height (px)</label>
                            <input type="number" id="slideHeight" value="340" min="200" max="600" step="1">
                            <p class="help-text">Height of individual slides</p>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="autoRotate">
                                Auto-rotate slides
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Auto-rotate Delay (ms)</label>
                            <input type="number" id="autoRotateDelay" value="4000" min="1000" step="500">
                            <p class="help-text">Time between each rotation</p>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="enableGlobalLink">
                                Enable Global Link for All Slides
                            </label>
                            <p class="help-text">Apply a default link to all slides (overridden by buttons or individual slide links)</p>
                        </div>
                        <div class="form-group" id="globalLinkGroup" style="display: none;">
                            <label>Global Link URL</label>
                            <input type="url" id="globalLink" placeholder="https://example.com">
                            <p class="help-text">This link applies to all slides unless they have a button or individual link</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slides Section -->
            <div class="section slides-section">
                <h2>Slides</h2>
                <button class="btn-primary" id="addSlideBtn" style="width: 100%; margin-bottom: 12px;">+ Add Slide</button>
                <div id="slidesList" class="slides-list"></div>
            </div>
        </div>

        <!-- Middle Panel: Slide Editor -->
        <div class="middle-panel" id="slideEditor" style="display: none;">
            <div class="panel-header">
                <h2 id="slideEditorTitle">Edit Slide</h2>
            </div>
            <div class="panel-content">
                <div id="slideEditorContent"></div>
            </div>
        </div>

        <!-- Right Panel: Preview -->
        <div class="right-panel">
            <div class="preview-header">
                <h2 id="previewTitle">Preview</h2>
                <div class="preview-controls">
                    <button class="btn-secondary active" id="focusModeBtn" title="Single Slide View (click to show full carousel)">
                        <i data-lucide="square" style="width: 16px; height: 16px;"></i>
                    </button>
                    <button class="btn-secondary" id="refreshPreviewBtn" title="Refresh Preview">
                        <i data-lucide="refresh-cw" style="width: 16px; height: 16px;"></i>
                    </button>
                    <button class="btn-secondary active" data-preview-mode="edit">Edit Mode</button>
                    <button class="btn-secondary" data-preview-mode="preview">Preview Mode</button>
                    <button class="btn-secondary active" data-preview="desktop">Desktop</button>
                    <button class="btn-secondary" data-preview="mobile">Mobile</button>
                </div>
            </div>

            <div class="preview-container" id="previewContainer">
                <iframe id="previewFrame" class="preview-frame desktop"></iframe>
            </div>
        </div>
    </div>

    <!-- Modal for adding new slide -->
    <div id="addSlideModal" class="modal">
        <div class="modal-content">
            <h2>Select Slide Type</h2>
            <div class="slide-types">
                <button class="slide-type-btn" data-type="fullImage">
                    <div class="slide-type-icon"><i data-lucide="image" style="width: 32px; height: 32px;"></i></div>
                    <div class="slide-type-name">Full Image</div>
                </button>
                <button class="slide-type-btn" data-type="fullImageWithText">
                    <div class="slide-type-icon"><i data-lucide="image-plus" style="width: 32px; height: 32px;"></i>
                    </div>
                    <div class="slide-type-name">Image with Text</div>
                </button>
                <button class="slide-type-btn" data-type="text">
                    <div class="slide-type-icon"><i data-lucide="file-text" style="width: 32px; height: 32px;"></i>
                    </div>
                    <div class="slide-type-name">Text Only</div>
                </button>
                <button class="slide-type-btn" data-type="video">
                    <div class="slide-type-icon"><i data-lucide="video" style="width: 32px; height: 32px;"></i></div>
                    <div class="slide-type-name">Video</div>
                </button>
                <button class="slide-type-btn" data-type="fullVideoWithText">
                    <div class="slide-type-icon"><i data-lucide="clapperboard" style="width: 32px; height: 32px;"></i>
                    </div>
                    <div class="slide-type-name">Video with Text</div>
                </button>
                <button class="slide-type-btn" data-type="bigNumber">
                    <div class="slide-type-icon"><i data-lucide="hash" style="width: 32px; height: 32px;"></i></div>
                    <div class="slide-type-name">Big Numbers</div>
                </button>
                <button class="slide-type-btn" data-type="imageSelector">
                    <div class="slide-type-icon"><i data-lucide="gallery-horizontal"
                            style="width: 32px; height: 32px;"></i></div>
                    <div class="slide-type-name">Image Selector</div>
                </button>
            </div>
            <button class="btn-secondary" id="cancelAddSlide">Cancel</button>
        </div>
    </div>

    <!-- Modal for loading projects -->
    <div id="loadProjectModal" class="modal">
        <div class="modal-content" style="max-width: 800px; width: 90vw;">
            <h2>Load Existing Carousel</h2>
            <div id="projectsList" style="max-height: 400px; overflow-y: auto; margin-bottom: 16px;">
                <!-- Projects will be listed here -->
            </div>
            <button class="btn-secondary" id="cancelLoadProject">Cancel</button>
        </div>
    </div>

    <!-- Startup Modal -->
    <div id="startupModal" class="modal active" style="background: rgba(0,0,0,0.95);">
        <div class="modal-content" style="max-width: 500px;">
            <h2 style="margin-bottom: 24px; text-align: center;">Welcome to Carousel Editor</h2>
            <p style="text-align: center; margin-bottom: 32px; color: #666;">Would you like to create a new carousel or load an existing project?</p>
            <div style="display: flex; flex-direction: column; gap: 12px;">
                <button class="btn-primary" id="startupCreateNew" style="padding: 16px; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i data-lucide="plus-circle" style="width: 20px; height: 20px;"></i>
                    Create New Carousel
                </button>
                <button class="btn-secondary" id="startupLoadExisting" style="padding: 16px; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i data-lucide="folder-open" style="width: 20px; height: 20px;"></i>
                    Load Existing Carousel
                </button>
            </div>
        </div>
    </div>

    <script type="module" src="./src/main.js?v=1.2.0"></script>
    <script>
        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    </script>
</body>

</html>